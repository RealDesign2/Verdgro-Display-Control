
<!-- Pop up menus -->

<div id="popupMenuLocal" data-role="popup" data-theme="b">
        <ul style="min-width: 210px;" data-role="listview" data-theme="b" data-inset="true">            
            <li data-role="divider" data-theme="b"><span id="MenuLocalAction">Choose an action</span></li>            
			<li><a href="#" onclick="LocalDelete();"><span id="MenuLocalDelete">Delete</span></a></li>
            <li><a href="#" onclick="$('#popupMenuLocal').popup('close'); sClickedImageID='';"><span id="MenuLocalCancel">Cancel</span></a></li>            
        </ul>
</div>

<div id="popupMenu" data-role="popup" data-theme="b">
        <ul style="min-width: 210px;" data-role="listview" data-theme="b" data-inset="true">            
            <li data-role="divider" data-theme="b"><span id="MenuPortalAction">Choose an action</span></li>
            <li><a href="#" onclick="PortalGetImage();"><span id="MenuPortalToLocalLibrary">Send to local Library</span></a></li>
            <li><a href="#" onclick="$('#popupMenu').popup('close'); sClickedImageID='';"><span id="MenuPortalCancel">Cancel</span></a></li>            
        </ul>
</div>

<!-- /Pop up menus -->

<!-- Accordion -->	
<div data-role="collapsible" data-collapsed="false">
	<h3><span id="TabLocal">Library (local)</span></h3>
	<div id="LibraryContainer"></div>
</div>

<div data-role="collapsible">
	<h3><span id="TabPortal">Library (portal)</span></h3>
	<button type="button" data-icon="refresh" data-iconpos="left" data-mini="true" data-inline="true" onClick="GetLibraryPortal()"><span id="ButtonRefresh">Refresh</span></button>	
	<div id="LibraryContainerOnline"></div>
</div>

<script>
	//Layout
	//Knoppen
	$("#btnBack").show();	
	$("#btnHome").show();

	//Vertaling instellen.	
	$("#LibraryTitle").html(jLang.LibraryTitle);
	$("#TabLocal").html(jLang.LibraryTabLocal);
	$("#TabPortal").html(jLang.LibraryTabPortal);
	$("#MenuPortalAction").html(jLang.LibraryMenuPortalAction);
	$("#MenuPortalToLocalLibrary").html(jLang.LibraryMenuPortalToLocalLibrary);
	$("#MenuPortalCancel").html(jLang.Cancel);
	$("#MenuLocalAction").html(jLang.LibraryMenuLocalAction);	
	$("#MenuLocalDelete").html(jLang.Delete);	
	$("#ButtonRefresh").html(jLang.Refresh);
	
	
	//=================================================================================
	var sClickedImageID = "";
	var sUser = "";
	
	
	if (DirectShowTab == 'tabOne') {
		switchTab('tabOne');
	} else {
		switchTab('tabTwo');
	}
	
		
	GetLibrary();					//Lokale library inlezen	
	GetLibraryPortal();				//portal library ophalen
	
	//=================================================================================
	
	//Functie die de library vanaf het netwerk haalt
	function GetLibraryPortal() {	
		//Leegmaken bibliotheek
		$("#LibraryContainerOnline").html("");
		
		var url = URLPortal + "app/LibraryRead.json.asp"
		var sResult = "";
		//alert(url);
		$.ajax(
			{
				//dataType: "json",
				url: url,
				encoding: "UTF-8",
				data: {"username" : appSettings.PortalUser, "password" : appSettings.PortalPass},
				async: false,
				timeout: 2000,
				cache: false
			})
			.done(function( data ) {
				sResult = "";
				sUser = data.user;	
				if (sUser.substring(0,4) != "Unkn"){
					if (data.files.length == 0) {
						sResult = "<br>" + jLang.LibraryNoItems + "<br><br>"
					} else {
						for (var i=0;i<data.files.length;i++)
						{ 
							sResult = sResult + "<img src='" + URLPortal + "library/" + data.user + "/" + data.files[i].file + "' onClick='PortalImageClick(this);'  id='img" + i + "'>&nbsp;&nbsp;"
						}
					}
					$("#LibraryContainerOnline").html(sResult);
				} else {
					$("#LibraryContainerOnline").html("<br>" + jLang.LibraryWrongCredentials + "<br><br>");
				} 
			})		
			.fail(function( jqXHR, textStatus ) {
				if (IsDebug == true) { 
					$("#LibraryContainerOnline").html("FAILURE (GetLibraryPortal)<br/>Status : " + jqXHR.status + "<br/>Message : " + jqXHR.responseText);
				} else {
					$("#LibraryContainerOnline").html("<br>" + jLang.LibraryNoInternet + "<br><br>");
				} 				
			}		
		);			
	} 	
	
	//Toont Internet Bibliotheek
	function GetLibrary() {
		var sResult = ""
		//$("#LibraryContainer").html(appSettings.Library.length)
		if (appSettings.Library.length == 0) {
			sResult = "<br>" + jLang.LibraryNoItems + "<br><br>"
		} else {
			for (var i=0;i<appSettings.Library.length;i++)
			{ 
				sResult = sResult + "<img src='" + appSettings.Library[i].base64 + "' style='width:80px;' alt='" + appSettings.Library[i].filename + "'onClick='LocalImageClick(this);'  id='imglocal" + i + "'>&nbsp;&nbsp;"
			}
		} 
		$("#LibraryContainer").html(sResult);
	} 
	
	function PortalImageClick(objElement) {
		//alert(objElement.id);
		sClickedImageID = objElement.id;
		var p = $("#" + objElement.id); 
		$( "#popupMenu" ).popup("open", {positionTo: '#' + objElement.id });
	}
	
			
	function PortalGetImage() {
		$('#popupMenu').popup('close');
		
		var sFile = $('#' + sClickedImageID).attr('src');
		var oImg = document.getElementById(sClickedImageID);	
		//toevoegen aan de library
		var jsonImage = { "filename": "", "base64" : ""} 
		jsonImage.filename = sFile.substring(sFile.lastIndexOf('/')+1);
		jsonImage.base64 = GetBase64FromImgObj(oImg)		
		appSettings.Library.push(jsonImage);
		//opslaan
		window.localStorage.appSettings = JSON.stringify(appSettings);		
		GetLibrary();
		navigator.notification.alert(jLang.LibraryAddedToLibrary, null, AlertTitle, 'OK');		
	} 
	
	function LocalDelete() {
		if (confirm(jLang.LibraryConfirmDelete) == true) {
			var sId = sClickedImageID;
			sId = sId.replace("imglocal", "")			
			//alert(sId);
			appSettings.Library.splice(parseInt(sId),1);
			//opslaan
			window.localStorage.appSettings = JSON.stringify(appSettings);	
			GetLibrary();
		} 
		$('#popupMenuLocal').popup('close');
	} 
	
</script>